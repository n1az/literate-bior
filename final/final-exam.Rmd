---
title: "Final Exam - Biostatistics & Epidemiological Data Analysis using R"
author: "Md Niaz Morshed"
date: "February 21, 2023"
output:
  html_document: default
---
  
## Importing the dataset
```{r}
library(haven)
kiggs_data <- read_sav("KiGGS03_06.sav")
```

## Creating kiggs dataframe with all the variables
```{r}
kiggs <- data.frame(E070M = kiggs_data$E070M, E070V = kiggs_data$E070V, E072 = kiggs_data$E072, E074 = kiggs_data$E074, arztZ01 = kiggs_data$arztZ01, sex = kiggs_data$sex, age2 = kiggs_data$age2, schichtz = kiggs_data$schichtz, e065z = kiggs_data$e065z)
```
## Using the provided formatting
```{r}
kiggs$E070M    <- factor(kiggs$E070M,    labels = c("yes, daily", "yes, occasionally", "no"))
kiggs$E070V    <- factor(kiggs$E070V,    labels = c("yes, daily", "yes, occasionally", "no"))
kiggs$E072     <- factor(kiggs$E072,     labels = c("yes, regularly", "yes, from time to time", "no, never"))
kiggs$E074     <- factor(kiggs$E074,     labels = c("yes, regularly", "yes, from time to time", "no, never", "has not breastfed"))
kiggs$sex      <- factor(kiggs$sex,      labels = c("boys", "girls"))
kiggs$age2     <- factor(kiggs$age2,     labels = c("0-1y", "2-3y", "4-5y", "6-7y", "8-9y", "10-11y", "12-13y", "14-15y", "16-17y"))
kiggs$schichtz <- factor(kiggs$schichtz, labels = c("low social status", "medium social status", "high social status"))
```
## Saving the formatted dataframe
```{r}
save(kiggs,file="kiggs.Rda")
```

## Checking if the E070M, E070V, E072, E074 variables are factors or not
```{r}
sapply(kiggs[0:4], class)
```
### It's showing that all the variables are factors.
```{r}
round(mean(kiggs$arztZ01, na.rm = TRUE),3)
table(kiggs$arztZ01)
```

## Setting the value "has not breastfed" of variable E074 to NA for all children
```{r}
levels(kiggs$E074)[levels(kiggs$E074)=="has not breastfed"]<-NA
```
## Deleting this NA factor level from the variable
```{r}
kiggs <- kiggs[!is.na(kiggs$E074), ]
```

## Checking whether these two steps worked as intended
```{r}
table(is.na(kiggs$E074))

```
## Calculating the new variable burdenS and adding to the dataset kiggs
```{r}
library(dplyr)
kiggs$burdenS <- dense_rank(kiggs$E070M)+ dense_rank(kiggs$E070V)+ dense_rank(kiggs$E072)+dense_rank(kiggs$E074)
table(kiggs$burdenS)

```
## We can see from the burdenS values, that the higher value means, the children were exposed to low level of smoking and lower value means a higher level of expose. And we can say that, the number of high level exposed children is verly low compared to the number of low level exposed children.

## Updating the previous file
```{r}
save(kiggs,file="kiggs.Rda")
```

## Calculating absolute frequency tables for age2, sex, burdenS, and mean + standard deviation for arztZ01.
```{r, results = "asis"}
library(qwraps2)
options(qwraps2_markup = "markdown")

our_summaryx <-
  list("age2" = 
       list("0-1y" = ~ qwraps2::n_perc0(age2 == "0-1y", show_symbol = TRUE, na_rm = TRUE),
            "2-3y" = ~ qwraps2::n_perc0(age2 == "2-3y", show_symbol = TRUE, na_rm = TRUE),
            "4-5y" = ~ qwraps2::n_perc0(age2 == "4-5y", show_symbol = TRUE, na_rm = TRUE),
            "6-7y" = ~ qwraps2::n_perc0(age2 == "6-7y", show_symbol = TRUE, na_rm = TRUE),
            "8-9y" = ~ qwraps2::n_perc0(age2 == "8-9y", show_symbol = TRUE, na_rm = TRUE),
            "10-11y" = ~ qwraps2::n_perc0(age2 == "10-11y", show_symbol = TRUE, na_rm = TRUE),
            "12-13y" = ~ qwraps2::n_perc0(age2 == "12-13y", show_symbol = TRUE, na_rm = TRUE),
            "14-15y" = ~ qwraps2::n_perc0(age2 == "14-15y", show_symbol = TRUE, na_rm = TRUE),
            "16-17y" = ~ qwraps2::n_perc0(age2 == "16-17y", show_symbol = TRUE, na_rm = TRUE)),
       "sex" = 
       list("boys" = ~ qwraps2::n_perc0(sex == "boys", show_symbol = TRUE, na_rm = TRUE),
            "girls" = ~ qwraps2::n_perc0(sex == "girls", show_symbol = TRUE, na_rm = TRUE)),
      "burdenS" = 
       list("4" = ~ qwraps2::n_perc0(burdenS == "4", show_symbol = TRUE, na_rm = TRUE),
            "5" = ~ qwraps2::n_perc0(burdenS == "5", show_symbol = TRUE, na_rm = TRUE),
            "6" = ~ qwraps2::n_perc0(burdenS == "6", show_symbol = TRUE, na_rm = TRUE),
            "7" = ~ qwraps2::n_perc0(burdenS == "7", show_symbol = TRUE, na_rm = TRUE),
            "8" = ~ qwraps2::n_perc0(burdenS == "8", show_symbol = TRUE, na_rm = TRUE),
            "9" = ~ qwraps2::n_perc0(burdenS == "9", show_symbol = TRUE, na_rm = TRUE),
            "10" = ~ qwraps2::n_perc0(burdenS == "10", show_symbol = TRUE, na_rm = TRUE),
            "11" = ~ qwraps2::n_perc0(burdenS == "11", show_symbol = TRUE, na_rm = TRUE),
            "12" = ~ qwraps2::n_perc0(burdenS == "12", show_symbol = TRUE, na_rm = TRUE)),
      "arztZ01" =
       list("Mean (SD)" = ~ qwraps2::mean_sd(arztZ01, digits = 3, denote_sd = "paren", na_rm = TRUE, show_n = "never"))
     )

qwraps2::summary_table(kiggs, our_summaryx)
```



## showing the number of missing values each of these 4 variables has, and how many observations have complete data for these 4 variables

```{r}
tablex <- matrix(c(sum(is.na(kiggs$age2)),sum(is.na(kiggs$sex)),sum(is.na(kiggs$burdenS)),sum(is.na(kiggs$arztZ01)),sum(!is.na(kiggs$age2)),sum(!is.na(kiggs$sex)),sum(!is.na(kiggs$burdenS)),sum(!is.na(kiggs$arztZ01))),ncol=4,byrow=TRUE)
colnames(tablex) <- c("age2", "sex", "burdenS", "arztZ01")
rownames(tablex) <- c("no of missing Values :", "no of completed values : ")
tx <- as.table(tablex)
tx
```
## Calculating linear regression
```{r}
lmx = lm(arztZ01 ~ burdenS + as.numeric(sex) + as.numeric(age2) + as.numeric(schichtz) + as.numeric(e065z), data = kiggs)
summary(lmx)
```



